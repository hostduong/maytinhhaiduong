{{ define "cua_hang_master" }}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .TieuDe }} - 99K.vn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f4f5; }
        .tab-btn.active { background-color: #e0e7ff; color: #2563eb; font-weight: 700; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .glass-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid #e4e4e7; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <header class="glass-header h-16 flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <a href="/" class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-black shadow-md">99</a>
            <span class="font-extrabold text-lg tracking-tight">Merchant Portal</span>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-sm font-medium text-slate-500">Xin ch√†o, <b>{{ .ChuShop.TenKhachHang }}</b></span>
            <a href="/logout" class="text-sm font-bold text-red-500 hover:text-red-700 bg-red-50 px-3 py-1.5 rounded-lg transition">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 bg-white border-r border-slate-200 flex flex-col p-4 shrink-0 overflow-y-auto">
            <div class="mb-6 px-3">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Qu·∫£n l√Ω C·ª≠a H√†ng</div>
            </div>
            <nav class="space-y-1">
                <button onclick="switchTab('tab_tongquan', this)" class="tab-btn active w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg> T·ªïng quan
                </button>
                <button onclick="switchTab('tab_hatang', this)" class="tab-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> C√†i ƒë·∫∑t Database
                </button>
                <button onclick="switchTab('tab_goicuoc', this)" class="tab-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg> G√≥i D·ªãch V·ª•
                </button>
            </nav>
            <div class="mt-auto pt-6 border-t border-slate-100">
                <a href="/tai-khoan" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> H·ªì s∆° c√° nh√¢n
                </a>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-8">
            <div class="max-w-4xl mx-auto">
                
                {{ if eq .ChuShop.DataSheets.SpreadsheetID "" }}
                <div class="mb-8 bg-red-50 border-l-4 border-red-500 p-6 rounded-r-2xl shadow-sm">
                    <div class="flex items-start">
                        <div class="flex-shrink-0"><svg class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg></div>
                        <div class="ml-4">
                            <h3 class="text-lg font-bold text-red-800">C·ª≠a h√†ng ch∆∞a th·ªÉ ho·∫°t ƒë·ªông!</h3>
                            <p class="mt-1 text-sm text-red-700">B·∫°n c·∫ßn k·∫øt n·ªëi Database (Google Sheets) ƒë·ªÉ h·ªá th·ªëng kh·ªüi t·∫°o c·ª≠a h√†ng. Vui l√≤ng chuy·ªÉn sang tab <b>C√†i ƒë·∫∑t Database</b> ƒë·ªÉ nh·∫≠p ID.</p>
                        </div>
                    </div>
                </div>
                {{ end }}

                <div id="tab_tongquan" class="tab-content active space-y-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">T·ªïng Quan Tr·∫°ng Th√°i</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">üåê</div>
                            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-2">T√™n mi·ªÅn h·ªá th·ªëng</h3>
                            <div class="text-2xl font-bold text-blue-600 mb-1">
                                {{ .ChuShop.TenDangNhap }}.99k.vn
                            </div>
                            <p class="text-sm text-slate-500 mb-6">T√™n mi·ªÅn ph·ª• ƒë∆∞·ª£c c·∫•p ph√°t mi·ªÖn ph√≠.</p>
                            
                            {{ if ne .ChuShop.DataSheets.SpreadsheetID "" }}
                                <a href="http://{{ .ChuShop.TenDangNhap }}.99k.vn/admin/tong-quan" target="_blank" class="inline-flex items-center justify-center gap-2 w-full bg-slate-900 hover:bg-black text-white px-5 py-3 rounded-xl font-bold transition shadow-md">
                                    V√†o Qu·∫£n Tr·ªã C·ª≠a H√†ng <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                </a>
                            {{ else }}
                                <button disabled class="w-full bg-slate-100 text-slate-400 px-5 py-3 rounded-xl font-bold cursor-not-allowed">Ch∆∞a c√≥ Database</button>
                            {{ end }}
                        </div>

                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-2">G√≥i D·ªãch V·ª• ƒêang D√πng</h3>
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl font-bold text-emerald-600">G√≥i D√πng Th·ª≠ (Trial)</span>
                                <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded-md">Active</span>
                            </div>
                            <p class="text-sm text-slate-600 font-medium mb-6">H·∫øt h·∫°n v√†o: <b>Ch∆∞a x√°c ƒë·ªãnh</b></p>
                            <button onclick="switchTab('tab_goicuoc', document.querySelectorAll('.tab-btn')[2])" class="w-full bg-white border-2 border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50 px-5 py-3 rounded-xl font-bold transition">
                                N√¢ng c·∫•p g√≥i / Gia h·∫°n
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tab_hatang" class="tab-content space-y-6">
                    <div>
                        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">C√†i ƒë·∫∑t Database</h1>
                        <p class="text-slate-500 mt-2">K·∫øt n·ªëi N·ªÅn t·∫£ng v·ªõi Google Sheet c·ªßa b·∫°n ƒë·ªÉ l√†m n∆°i l∆∞u tr·ªØ d·ªØ li·ªáu an to√†n 100%.</p>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
                        <form id="formHaTang" class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Spreadsheet ID (B·∫Øt bu·ªôc) <span class="text-red-500">*</span></label>
                                <input type="text" name="spreadsheet_id" value="{{ .ChuShop.DataSheets.SpreadsheetID }}" class="w-full p-4 bg-slate-50 border border-slate-300 rounded-xl font-mono text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="VD: 1BxiMVs0XRX5m...">
                                <p class="text-xs text-slate-500 mt-2 leading-relaxed">
                                    ID l√† d·∫£i k√Ω t·ª± n·∫±m gi·ªØa <b>/d/</b> v√† <b>/edit</b> trong ƒë∆∞·ªùng link Google Sheet c·ªßa b·∫°n.<br>
                                    <i>L∆∞u √Ω:</i> H√£y nh·ªõ Share quy·ªÅn Editor (Ch·ªânh s·ª≠a) cho Email h·ªá th·ªëng: <b class="text-blue-600">system-bot@99k-project.iam.gserviceaccount.com</b>
                                </p>
                            </div>

                            <hr class="border-slate-100">

                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">T√™n mi·ªÅn ri√™ng (Custom Domain)</label>
                                <input type="text" name="custom_domain" value="{{ .ChuShop.CauHinh.CustomDomain }}" class="w-full p-4 bg-slate-50 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="VD: www.shopcuaban.com">
                                <p class="text-xs text-slate-500 mt-2">Ch·ªâ ƒëi·ªÅn n·∫øu b·∫°n ƒë√£ mua t√™n mi·ªÅn ri√™ng v√† tr·ªè CNAME v·ªÅ h·ªá th·ªëng.</p>
                            </div>

                            <div class="pt-4 flex justify-end">
                                <button type="button" id="btnSaveHaTang" onclick="luuHaTang()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3.5 rounded-xl font-bold shadow-lg shadow-blue-200 transition transform hover:-translate-y-0.5 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                                    L∆∞u C·∫•u H√¨nh
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="tab_goicuoc" class="tab-content space-y-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">G√≥i D·ªãch V·ª• & Thanh To√°n</h1>
                    
                    <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-blue-500 opacity-20 blur-3xl"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold mb-2">B·∫£ng gi√° d√†nh cho c·ª≠a h√†ng</h2>
                            <p class="text-slate-400 mb-8 max-w-xl">H·ªá th·ªëng ƒëang h·ªó tr·ª£ thanh to√°n gia h·∫°n qua chuy·ªÉn kho·∫£n t·ª± ƒë·ªông. M√£ QR s·∫Ω ƒë∆∞·ª£c t·∫°o t∆∞∆°ng ·ª©ng v·ªõi g√≥i b·∫°n ch·ªçn.</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white/10 border border-white/20 p-6 rounded-xl backdrop-blur-sm hover:bg-white/20 transition cursor-pointer">
                                    <h3 class="text-xl font-bold mb-1">G√≥i C∆° B·∫£n (Th√°ng)</h3>
                                    <div class="text-3xl font-black text-blue-400 mb-4">99.000 ‚Ç´<span class="text-sm font-normal text-slate-300">/th√°ng</span></div>
                                    <ul class="text-sm space-y-2 mb-6 text-slate-300">
                                        <li>‚úì Website b√°n h√†ng chu·∫©n SEO</li>
                                        <li>‚úì Qu·∫£n l√Ω 5.000 s·∫£n ph·∫©m</li>
                                        <li>‚úì Mi·ªÖn ph√≠ ch·ª©ng ch·ªâ SSL</li>
                                    </ul>
                                    <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 rounded-lg transition">Ch·ªçn G√≥i N√†y</button>
                                </div>
                                <div class="bg-gradient-to-b from-blue-600 to-blue-800 border border-blue-500 p-6 rounded-xl shadow-lg relative transform scale-105">
                                    <div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-black px-2 py-1 rounded-bl-lg rounded-tr-lg uppercase">Ti·∫øt ki·ªám 20%</div>
                                    <h3 class="text-xl font-bold mb-1">G√≥i Chuy√™n Nghi·ªáp (NƒÉm)</h3>
                                    <div class="text-3xl font-black text-white mb-4">990.000 ‚Ç´<span class="text-sm font-normal text-blue-200">/nƒÉm</span></div>
                                    <ul class="text-sm space-y-2 mb-6 text-blue-100">
                                        <li>‚úì T√™n mi·ªÅn ri√™ng (Custom Domain)</li>
                                        <li>‚úì API ƒê·ªìng b·ªô t·ªìn kho si√™u t·ªëc</li>
                                        <li>‚úì H·ªó tr·ª£ k·ªπ thu·∫≠t ∆∞u ti√™n 24/7</li>
                                    </ul>
                                    <button class="w-full bg-white text-blue-800 hover:bg-blue-50 font-bold py-2.5 rounded-lg transition shadow-md">Ch·ªçn G√≥i N√†y</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        async function luuHaTang() {
            const btn = document.getElementById('btnSaveHaTang');
            const originTxt = btn.innerHTML;
            btn.disabled = true; btn.innerHTML = 'ƒêang x·ª≠ l√Ω...';

            const fd = new FormData(document.getElementById('formHaTang'));
            try {
                const res = await fetch('/cua-hang/api/cap-nhat-id', { method: 'POST', body: fd });
                const data = await res.json();
                if(data.status === 'ok') {
                    Swal.fire({icon: 'success', title: 'Th√†nh c√¥ng', text: data.msg, timer: 1500}).then(() => location.reload());
                } else {
                    Swal.fire('L·ªói', data.msg, 'error');
                }
            } catch (e) {
                Swal.fire('L·ªói', 'Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c v·ªõi server', 'error');
            } finally {
                btn.disabled = false; btn.innerHTML = originTxt;
            }
        }
    </script>
</body>
</html>
{{ end }}
