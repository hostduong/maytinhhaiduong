{{ define "cua_hang_master" }}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .TieuDe }} - 99K.vn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f4f5; }
        .tab-btn { transition: all 0.2s; }
        .tab-btn.active { background-color: #e0e7ff; color: #2563eb; font-weight: 700; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .glass-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid #e4e4e7; }
        
        /* CSS cho form H·ªì s∆° */
        .input-error { border-color: #ef4444 !important; background-color: #fef2f2; }
        .input-success { border-color: #22c55e !important; background-color: #f0fdf4; }
        .input-normal { border-color: #d1d5db !important; background-color: #fff; }
        .error-text { color: #ef4444; font-size: 0.75rem; margin-top: 0.25rem; display: none; }
        .error-text.show { display: block; }
        .iti { width: 100%; }
        input::-ms-reveal, input::-ms-clear { display: none; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <header class="glass-header h-16 flex items-center justify-between px-6 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <a href="/" class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-black shadow-md">99</a>
            <span class="font-extrabold text-lg tracking-tight">Merchant Portal</span>
        </div>
        <div class="flex items-center gap-4">
            <span class="text-sm font-medium text-slate-500">Xin ch√†o, <b>{{ .ChuShop.TenKhachHang }}</b></span>
            <a href="/logout" class="text-sm font-bold text-red-500 hover:text-red-700 bg-red-50 px-3 py-1.5 rounded-lg transition">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 bg-white border-r border-slate-200 flex flex-col p-4 shrink-0 overflow-y-auto">
            <div class="mb-6 px-3">
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Qu·∫£n l√Ω C·ª≠a H√†ng</div>
            </div>
            <nav class="space-y-1">
                <button onclick="switchTab('tab_tongquan', this)" class="tab-btn active w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg> T·ªïng quan
                </button>
                <button onclick="switchTab('tab_hatang', this)" class="tab-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path></svg> C√†i ƒë·∫∑t Database
                </button>
                <button onclick="switchTab('tab_goicuoc', this)" class="tab-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg> G√≥i D·ªãch V·ª•
                </button>
            </nav>
            <div class="mt-auto pt-6 border-t border-slate-100">
                <button onclick="switchTab('tab_hoso', this)" class="tab-btn w-full flex items-center gap-3 px-3 py-2.5 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> H·ªì s∆° c√° nh√¢n
                </button>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto p-8">
            <div class="max-w-4xl mx-auto">
                
                {{ if eq .ChuShop.DataSheets.SpreadsheetID "" }}
                <div class="mb-8 bg-red-50 border-l-4 border-red-500 p-6 rounded-r-2xl shadow-sm">
                    <div class="flex items-start">
                        <div class="flex-shrink-0"><svg class="h-6 w-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg></div>
                        <div class="ml-4">
                            <h3 class="text-lg font-bold text-red-800">C·ª≠a h√†ng ch∆∞a th·ªÉ ho·∫°t ƒë·ªông!</h3>
                            <p class="mt-1 text-sm text-red-700">B·∫°n c·∫ßn k·∫øt n·ªëi Database (Google Sheets) ƒë·ªÉ h·ªá th·ªëng kh·ªüi t·∫°o c·ª≠a h√†ng. Vui l√≤ng chuy·ªÉn sang tab <b>C√†i ƒë·∫∑t Database</b> ƒë·ªÉ nh·∫≠p ID.</p>
                        </div>
                    </div>
                </div>
                {{ end }}

                <div id="tab_tongquan" class="tab-content active space-y-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">T·ªïng Quan Tr·∫°ng Th√°i</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl">üåê</div>
                            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-2">T√™n mi·ªÅn h·ªá th·ªëng</h3>
                            <div class="text-2xl font-bold text-blue-600 mb-1">{{ .ChuShop.TenDangNhap }}.99k.vn</div>
                            <p class="text-sm text-slate-500 mb-6">T√™n mi·ªÅn ph·ª• ƒë∆∞·ª£c c·∫•p ph√°t mi·ªÖn ph√≠.</p>
                            {{ if ne .ChuShop.DataSheets.SpreadsheetID "" }}
                                <a href="http://{{ .ChuShop.TenDangNhap }}.99k.vn/admin/tong-quan" target="_blank" class="inline-flex items-center justify-center gap-2 w-full bg-slate-900 hover:bg-black text-white px-5 py-3 rounded-xl font-bold transition shadow-md">
                                    V√†o Qu·∫£n Tr·ªã C·ª≠a H√†ng <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                                </a>
                            {{ else }}
                                <button disabled class="w-full bg-slate-100 text-slate-400 px-5 py-3 rounded-xl font-bold cursor-not-allowed">Ch∆∞a c√≥ Database</button>
                            {{ end }}
                        </div>

                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                            <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-2">G√≥i D·ªãch V·ª• ƒêang D√πng</h3>
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl font-bold text-emerald-600">G√≥i D√πng Th·ª≠</span>
                                <span class="bg-emerald-100 text-emerald-800 text-xs font-bold px-2 py-1 rounded-md">Active</span>
                            </div>
                            <p class="text-sm text-slate-600 font-medium mb-6">H·∫øt h·∫°n v√†o: <b>Ch∆∞a x√°c ƒë·ªãnh</b></p>
                            <button onclick="switchTab('tab_goicuoc', document.querySelectorAll('.tab-btn')[2])" class="w-full bg-white border-2 border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50 px-5 py-3 rounded-xl font-bold transition">
                                N√¢ng c·∫•p g√≥i / Gia h·∫°n
                            </button>
                        </div>
                    </div>
                </div>

                <div id="tab_hatang" class="tab-content space-y-6">
                    <div>
                        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">C√†i ƒë·∫∑t Database</h1>
                        <p class="text-slate-500 mt-2">K·∫øt n·ªëi N·ªÅn t·∫£ng v·ªõi Google Sheet c·ªßa b·∫°n ƒë·ªÉ l√†m n∆°i l∆∞u tr·ªØ d·ªØ li·ªáu an to√†n 100%.</p>
                    </div>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8">
                        <form id="formHaTang" class="space-y-6">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">Spreadsheet ID (B·∫Øt bu·ªôc) <span class="text-red-500">*</span></label>
                                <input type="text" name="spreadsheet_id" value="{{ .ChuShop.DataSheets.SpreadsheetID }}" class="w-full p-4 bg-slate-50 border border-slate-300 rounded-xl font-mono text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="VD: 1BxiMVs0XRX5m...">
                                <p class="text-xs text-slate-500 mt-2 leading-relaxed">
                                    ID l√† d·∫£i k√Ω t·ª± n·∫±m gi·ªØa <b>/d/</b> v√† <b>/edit</b> trong ƒë∆∞·ªùng link Google Sheet c·ªßa b·∫°n.<br>
                                    <i>L∆∞u √Ω:</i> H√£y nh·ªõ Share quy·ªÅn Editor (Ch·ªânh s·ª≠a) cho Email h·ªá th·ªëng: <b class="text-blue-600">system-bot@99k-project.iam.gserviceaccount.com</b>
                                </p>
                            </div>
                            <hr class="border-slate-100">
                            <div>
                                <label class="block text-sm font-bold text-slate-700 mb-2">T√™n mi·ªÅn ri√™ng (Custom Domain)</label>
                                <input type="text" name="custom_domain" value="{{ .ChuShop.CauHinh.CustomDomain }}" class="w-full p-4 bg-slate-50 border border-slate-300 rounded-xl text-sm focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="VD: www.shopcuaban.com">
                                <p class="text-xs text-slate-500 mt-2">Ch·ªâ ƒëi·ªÅn n·∫øu b·∫°n ƒë√£ mua t√™n mi·ªÅn ri√™ng v√† tr·ªè CNAME v·ªÅ h·ªá th·ªëng.</p>
                            </div>
                            <div class="pt-4 flex justify-end">
                                <button type="button" id="btnSaveHaTang" onclick="luuHaTang()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3.5 rounded-xl font-bold shadow-lg shadow-blue-200 transition transform hover:-translate-y-0.5 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                                    L∆∞u C·∫•u H√¨nh
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="tab_goicuoc" class="tab-content space-y-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">G√≥i D·ªãch V·ª• & Thanh To√°n</h1>
                    
                    <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 rounded-full bg-blue-500 opacity-20 blur-3xl"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold mb-2">B·∫£ng gi√° d√†nh cho c·ª≠a h√†ng</h2>
                            <p class="text-slate-400 mb-8 max-w-xl">H·ªá th·ªëng ƒëang h·ªó tr·ª£ thanh to√°n gia h·∫°n qua chuy·ªÉn kho·∫£n t·ª± ƒë·ªông. M√£ QR s·∫Ω ƒë∆∞·ª£c t·∫°o t∆∞∆°ng ·ª©ng v·ªõi g√≥i b·∫°n ch·ªçn.</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white/10 border border-white/20 p-6 rounded-xl backdrop-blur-sm hover:bg-white/20 transition cursor-pointer">
                                    <h3 class="text-xl font-bold mb-1">G√≥i C∆° B·∫£n (Th√°ng)</h3>
                                    <div class="text-3xl font-black text-blue-400 mb-4">99.000 ‚Ç´<span class="text-sm font-normal text-slate-300">/th√°ng</span></div>
                                    <ul class="text-sm space-y-2 mb-6 text-slate-300">
                                        <li>‚úì Website b√°n h√†ng chu·∫©n SEO</li>
                                        <li>‚úì Qu·∫£n l√Ω 5.000 s·∫£n ph·∫©m</li>
                                        <li>‚úì Mi·ªÖn ph√≠ ch·ª©ng ch·ªâ SSL</li>
                                    </ul>
                                    <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2.5 rounded-lg transition">Ch·ªçn G√≥i N√†y</button>
                                </div>
                                <div class="bg-gradient-to-b from-blue-600 to-blue-800 border border-blue-500 p-6 rounded-xl shadow-lg relative transform scale-105">
                                    <div class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-black px-2 py-1 rounded-bl-lg rounded-tr-lg uppercase">Ti·∫øt ki·ªám 20%</div>
                                    <h3 class="text-xl font-bold mb-1">G√≥i Chuy√™n Nghi·ªáp (NƒÉm)</h3>
                                    <div class="text-3xl font-black text-white mb-4">990.000 ‚Ç´<span class="text-sm font-normal text-blue-200">/nƒÉm</span></div>
                                    <ul class="text-sm space-y-2 mb-6 text-blue-100">
                                        <li>‚úì T√™n mi·ªÅn ri√™ng (Custom Domain)</li>
                                        <li>‚úì API ƒê·ªìng b·ªô t·ªìn kho si√™u t·ªëc</li>
                                        <li>‚úì H·ªó tr·ª£ k·ªπ thu·∫≠t ∆∞u ti√™n 24/7</li>
                                    </ul>
                                    <button class="w-full bg-white text-blue-800 hover:bg-blue-50 font-bold py-2.5 rounded-lg transition shadow-md">Ch·ªçn G√≥i N√†y</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab_hoso" class="tab-content space-y-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">H·ªì S∆° Ch·ªß Shop</h1>

                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 h-32 relative"></div>
                        <div class="text-center -mt-16 relative px-6">
                            <div class="inline-block p-1 bg-white rounded-full shadow-md">
                                <div class="w-28 h-28 bg-gray-100 rounded-full flex items-center justify-center overflow-hidden border-2 border-white shadow-inner">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ .ChuShop.TenDangNhap }}" alt="Avatar" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <h2 class="mt-3 text-3xl font-bold text-gray-800" id="lblHoTen">{{ .ChuShop.TenKhachHang }}</h2>
                            <div class="text-blue-600 font-bold bg-blue-50 inline-block px-4 py-1 rounded-full text-xs mt-2 tracking-widest border border-blue-100">
                                {{ .ChuShop.ChucVu }}
                            </div>
                        </div>
                        <div class="flex flex-wrap justify-center gap-3 py-8 px-6">
                            <button onclick="toggleModal('modalInfo')" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-5 py-2.5 rounded-xl font-semibold shadow-sm transition">C·∫≠p nh·∫≠t h·ªì s∆°</button>
                            <button onclick="toggleModal('modalPass')" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-semibold shadow-md transition">ƒê·ªïi m·∫≠t kh·∫©u</button>
                            <button onclick="toggleModal('modalPin')" class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2.5 rounded-xl font-semibold shadow-md transition">ƒê·ªïi m√£ PIN</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
                            <h3 class="text-xl font-bold text-gray-800 border-b pb-4 mb-2">Th√¥ng tin li√™n h·ªá</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">S·ªë ƒëi·ªán tho·∫°i</label><div class="text-gray-900 font-semibold">{{ if .ChuShop.DienThoai }} {{ .ChuShop.DienThoai }} {{ else }} -- {{ end }}</div></div>
                                <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">Email</label><div class="text-gray-900 font-semibold truncate">{{ .ChuShop.Email }}</div></div>
                                <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">Ng√†y sinh</label><div class="text-gray-900 font-semibold">{{ if .ChuShop.NgaySinh }} {{ .ChuShop.NgaySinh }} {{ else }} --/--/---- {{ end }}</div></div>
                                <div class="md:col-span-2"><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">ƒê·ªãa ch·ªâ</label><div class="text-gray-900 font-semibold">{{ if .ChuShop.DiaChi }} {{ .ChuShop.DiaChi }} {{ else }} <span class="text-gray-400 italic">Ch∆∞a c·∫≠p nh·∫≠t</span> {{ end }}</div></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
                            <h3 class="text-xl font-bold text-gray-800 border-b pb-4 mb-2">ƒê·ªãnh danh N·ªÅn t·∫£ng</h3>
                            <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">T√™n ƒëƒÉng nh·∫≠p (Domain)</label><div class="text-gray-900 font-semibold italic">{{ .ChuShop.TenDangNhap }}</div></div>
                            <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">M√£ s·ªë thu·∫ø</label><div class="text-gray-900 font-semibold">{{ if .ChuShop.MaSoThue }} {{ .ChuShop.MaSoThue }} {{ else }} -- {{ end }}</div></div>
                            <div><label class="text-[10px] text-gray-400 uppercase font-bold tracking-widest block mb-1">Zalo H·ªó Tr·ª£</label><div class="text-blue-600 font-medium">{{ if .ChuShop.MangXaHoi.Zalo }} {{ .ChuShop.MangXaHoi.Zalo }} {{ else }} -- {{ end }}</div></div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="modalInfo" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl transform transition-all max-h-[90vh] overflow-y-auto">
            <div class="p-8">
                <h3 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">‚úèÔ∏è C·∫≠p nh·∫≠t h·ªì s∆°</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div class="md:col-span-2"><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">H·ªç v√† t√™n</label><input type="text" id="newName" value="{{ .ChuShop.TenKhachHang }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none input-normal"><p id="err_newName" class="error-text">H·ªç t√™n kh√¥ng h·ª£p l·ªá.</p></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">S·ªë ƒëi·ªán tho·∫°i</label><input type="tel" id="newPhone" value="{{ .ChuShop.DienThoai }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none input-normal"><p id="err_newPhone" class="error-text">SƒêT kh√¥ng h·ª£p l·ªá.</p></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Ng√†y sinh</label><input type="date" id="newDob" value="{{ .ChuShop.NgaySinh }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none"></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Gi·ªõi t√≠nh</label><select id="newGender" class="w-full p-3 border border-gray-300 rounded-xl outline-none"><option value="Nam" {{ if eq .ChuShop.GioiTinh 1 }}selected{{ end }}>Nam</option><option value="N·ªØ" {{ if eq .ChuShop.GioiTinh 0 }}selected{{ end }}>N·ªØ</option><option value="Kh√°c" {{ if eq .ChuShop.GioiTinh -1 }}selected{{ end }}>Kh√°c</option></select></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">M√£ s·ªë thu·∫ø</label><input type="text" id="newTax" value="{{ .ChuShop.MaSoThue }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none input-normal"><p id="err_newTax" class="error-text">Ch·ªâ nh·∫≠p s·ªë.</p></div>
                    <div class="md:col-span-2"><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">ƒê·ªãa ch·ªâ</label><input type="text" id="newAddress" value="{{ .ChuShop.DiaChi }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none"></div>
                    <div class="md:col-span-2 border-t pt-4 mt-2"><h4 class="text-sm font-bold text-blue-600 mb-3">M·∫°ng x√£ h·ªôi</h4></div>
                    <div><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Zalo (SƒêT)</label><input type="text" id="newZalo" value="{{ .ChuShop.MangXaHoi.Zalo }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none"></div>
                    <div class="md:col-span-2"><label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Link Facebook</label><input type="text" id="newFb" value="{{ .ChuShop.MangXaHoi.Facebook }}" class="w-full p-3 border border-gray-300 rounded-xl outline-none input-normal"><p id="err_newFb" class="error-text">Link ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://</p></div>
                </div>
                <div class="mt-8 flex justify-end gap-3 pt-5 border-t">
                    <button onclick="toggleModal('modalInfo')" class="text-gray-500 hover:bg-gray-100 px-6 py-2.5 rounded-xl font-semibold">H·ªßy</button>
                    <button id="btnSaveInfo" onclick="capNhatThongTin()" class="bg-blue-600 text-white px-8 py-2.5 rounded-xl font-bold shadow-lg">L∆∞u thay ƒë·ªïi</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalPass" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-6 text-gray-800">üîê ƒê·ªïi m·∫≠t kh·∫©u</h3>
            <div class="space-y-4">
                <div class="relative">
                    <input type="password" id="oldPass" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i" class="w-full p-3.5 pr-10 border border-gray-300 rounded-xl outline-none">
                    <button type="button" onclick="togglePass('oldPass')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-gray-400">üëÅÔ∏è</button>
                </div>
                <div class="relative">
                    <input type="password" id="newPass" placeholder="M·∫≠t kh·∫©u m·ªõi (8-30 k√Ω t·ª±)" class="w-full p-3.5 pr-10 border border-gray-300 rounded-xl outline-none input-normal">
                    <button type="button" onclick="togglePass('newPass')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-gray-400">üëÅÔ∏è</button>
                    <p id="err_newPass" class="error-text">8-30 k√Ω t·ª±. Ch·ªØ, s·ªë, k√Ω t·ª± ƒë·∫∑c bi·ªát.</p>
                </div>
            </div>
            <div class="mt-8 flex justify-end gap-3 border-t pt-5">
                <button onclick="toggleModal('modalPass')" class="text-gray-500 px-5 py-2.5 rounded-xl font-semibold">H·ªßy</button>
                <button id="btnSavePass" onclick="doiPass()" disabled class="bg-blue-600 text-white px-6 py-2.5 rounded-xl font-bold">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <div id="modalPin" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 backdrop-blur-sm p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-md">
            <h3 class="text-2xl font-bold mb-2 text-gray-800">üî¢ ƒê·ªïi m√£ PIN</h3>
            <div id="viewChangePin" class="space-y-4 pt-4">
                <div class="relative"><input type="password" id="oldPin" maxlength="8" placeholder="M√£ PIN hi·ªán t·∫°i" class="w-full p-3.5 pr-10 border border-gray-300 rounded-xl outline-none"><button type="button" onclick="togglePass('oldPin')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-gray-400">üëÅÔ∏è</button></div>
                <div class="relative"><input type="password" id="newPin" maxlength="8" placeholder="M√£ PIN m·ªõi (8 s·ªë)" class="w-full p-3.5 pr-10 border border-gray-300 rounded-xl outline-none input-normal"><button type="button" onclick="togglePass('newPin')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-gray-400">üëÅÔ∏è</button><p id="err_newPin" class="error-text">M√£ PIN ph·∫£i ƒë√∫ng 8 ch·ªØ s·ªë.</p></div>
                <div class="mt-6 flex justify-end gap-3 border-t pt-5"><button onclick="toggleModal('modalPin')" class="text-gray-500 px-4 py-2.5 rounded-xl font-semibold">H·ªßy</button><button id="btnSavePin" onclick="doiPin()" disabled class="bg-purple-600 text-white px-6 py-2.5 rounded-xl font-bold">L∆∞u PIN</button></div>
            </div>
        </div>
    </div>

    <script>
        // Tab UI Logic
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Logic H·∫° T·∫ßng
        async function luuHaTang() {
            const btn = document.getElementById('btnSaveHaTang');
            const originTxt = btn.innerHTML;
            btn.disabled = true; btn.innerHTML = 'ƒêang x·ª≠ l√Ω...';

            const fd = new FormData(document.getElementById('formHaTang'));
            try {
                const res = await fetch('/cua-hang/api/cap-nhat-id', { method: 'POST', body: fd });
                const data = await res.json();
                if(data.status === 'ok') {
                    Swal.fire({icon: 'success', title: 'Th√†nh c√¥ng', text: data.msg, timer: 1500}).then(() => location.reload());
                } else { Swal.fire('L·ªói', data.msg, 'error'); }
            } catch (e) { Swal.fire('L·ªói', 'Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c v·ªõi server', 'error'); } 
            finally { btn.disabled = false; btn.innerHTML = originTxt; }
        }

        // Logic H·ªì S∆° (K·∫ø th·ª´a t·ª´ file c≈©)
        const inputPhone = document.querySelector("#newPhone");
        let iti;
        if(inputPhone) {
            iti = window.intlTelInput(inputPhone, { initialCountry: "vn", separateDialCode: true, utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js" });
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function togglePass(id) { const input = document.getElementById(id); input.type = input.type === "password" ? "text" : "password"; }
        
        function setError(id, errId, isError) {
            const input = document.getElementById(id); const msg = document.getElementById(errId);
            if(isError) { input.classList.add('input-error'); input.classList.remove('input-success'); msg.classList.add('show'); } 
            else { input.classList.remove('input-error'); if(input.value.trim()!=="") input.classList.add('input-success'); msg.classList.remove('show'); }
            if(id.includes("Pass")) checkPassBtn(); if(id.includes("Pin")) checkPinBtn();
        }

        const regexPass = /^[a-zA-Z0-9!@#$%^&*()\-+_.,?]{8,30}$/;
        const regexPin  = /^\d{8}$/;

        document.getElementById('newPass').addEventListener('input', function() { setError(this.id, 'err_newPass', !regexPass.test(this.value)); });
        document.getElementById('newPin').addEventListener('input', function() { setError(this.id, 'err_newPin', !regexPin.test(this.value)); });
        document.getElementById('oldPass').addEventListener('input', checkPassBtn);
        document.getElementById('oldPin').addEventListener('input', checkPinBtn);

        function checkPassBtn() { document.getElementById('btnSavePass').disabled = !(document.getElementById('newPass').classList.contains('input-success') && document.getElementById('oldPass').value.length > 0); }
        function checkPinBtn() { document.getElementById('btnSavePin').disabled = !(document.getElementById('newPin').classList.contains('input-success') && document.getElementById('oldPin').value.length > 0); }

        async function postData(url, data) {
            const fd = new FormData(); for(const k in data) fd.append(k, data[k]);
            try { const r = await fetch(url, {method:'POST', body:fd}); return await r.json(); } catch(e){ return {status:'error', msg:'L·ªói m·∫°ng'}; }
        }

        async function capNhatThongTin() {
            const btn = document.getElementById('btnSaveInfo'); btn.disabled = true; btn.innerText = "ƒêang l∆∞u...";
            const data = {
                ho_ten: document.getElementById('newName').value, dien_thoai: iti ? iti.getNumber() : document.getElementById('newPhone').value,
                ngay_sinh: document.getElementById('newDob').value, gioi_tinh: document.getElementById('newGender').value,
                dia_chi: document.getElementById('newAddress').value, ma_so_thue: document.getElementById('newTax').value,
                zalo: document.getElementById('newZalo').value, url_fb: document.getElementById('newFb').value
            };
            const res = await postData('/api/user/update-info', data);
            if(res.status === 'ok') Swal.fire({icon:'success', title:'Th√†nh c√¥ng', text:res.msg}).then(()=>location.reload());
            else { Swal.fire({icon:'error', title:'L·ªói', text:res.msg}); btn.disabled = false; btn.innerText = "L∆∞u thay ƒë·ªïi"; }
        }

        async function doiPass() {
            const btn = document.getElementById('btnSavePass'); btn.disabled = true; btn.innerText = "ƒêang l∆∞u...";
            const res = await postData('/api/user/change-pass', { pass_cu: document.getElementById('oldPass').value, pass_moi: document.getElementById('newPass').value });
            if(res.status === 'ok') Swal.fire({icon:'success', title:'Th√†nh c√¥ng', text:res.msg}).then(()=>location.reload());
            else { Swal.fire({icon:'error', title:'L·ªói', text:res.msg}); btn.disabled = false; btn.innerText = "L∆∞u thay ƒë·ªïi"; }
        }

        async function doiPin() {
            const btn = document.getElementById('btnSavePin'); btn.disabled = true; btn.innerText = "ƒêang l∆∞u...";
            const res = await postData('/api/user/change-pin', { pin_cu: document.getElementById('oldPin').value, pin_moi: document.getElementById('newPin').value });
            if(res.status === 'ok') Swal.fire({icon:'success', title:'Th√†nh c√¥ng', text:res.msg}).then(()=>location.reload());
            else { Swal.fire({icon:'error', title:'L·ªói', text:res.msg}); btn.disabled = false; btn.innerText = "L∆∞u PIN"; }
        }
    </script>
</body>
</html>
{{ end }}
