{{ define "master_thanh_vien" }}
    {{ template "header_master" . }}
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/css/intlTelInput.css">
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/intlTelInput.min.js"></script>

    <style>
        .input-premium { width: 100%; box-sizing: border-box; background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; font-size: 0.9rem; padding: 0.75rem 1rem; transition: 0.2s; outline: none; }
        .input-premium:focus { border-color: #9333ea; box-shadow: 0 0 0 3px rgba(147,51,234,0.1); background-color: #fff; }
        .input-premium:disabled, .input-premium[readonly] { cursor: not-allowed; opacity: 0.7; background-color: #f1f5f9; }
        label.form-lbl { font-size: 0.65rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-bottom: 0.4rem; display: block; letter-spacing: 0.05em; }
        .iti { width: 100%; } 
        
        .table-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .table-scroll::-webkit-scrollbar { height: 12px; }
        .table-scroll::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 8px; box-shadow: inset 0 0 4px rgba(0,0,0,0.05); margin: 0 4px; }
        .table-scroll::-webkit-scrollbar-thumb { background-color: #c084fc; background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.4) 50%, transparent); border-radius: 8px; border: 2px solid #f1f5f9; }
        .table-scroll::-webkit-scrollbar-thumb:hover { background-color: #9333ea; }
        .table-scroll::-webkit-scrollbar-button:single-button { display: block; border-style: solid; height: 12px; width: 16px; background-color: #f1f5f9; }
        .table-scroll::-webkit-scrollbar-button:single-button:horizontal:decrement { border-width: 6px 8px 6px 0; border-color: transparent #a855f7 transparent transparent; }
        .table-scroll::-webkit-scrollbar-button:single-button:horizontal:decrement:hover { border-color: transparent #7e22ce transparent transparent; }
        .table-scroll::-webkit-scrollbar-button:single-button:horizontal:increment { border-width: 6px 0 6px 8px; border-color: transparent transparent transparent #a855f7; }
        .table-scroll::-webkit-scrollbar-button:single-button:horizontal:increment:hover { border-color: transparent transparent transparent #7e22ce; }
    </style>

    <div class="max-w-7xl mx-auto mb-10">
        
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-5">
            <div class="flex items-center gap-3">
                <div class="p-2.5 bg-purple-100 text-purple-600 rounded-xl shadow-inner shrink-0">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                </div>
                <h1 class="text-2xl sm:text-3xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-purple-700 to-indigo-600">Qu·∫£n L√Ω Core Team</h1>
            </div>
            
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full lg:w-auto">
                <div class="relative w-full sm:w-72">
                    <input type="text" id="searchMember" onkeyup="filterTable('searchMember', 'tbodyMembers')" placeholder="T√¨m ID, T√™n, SƒêT, Zalo, Ngu·ªìn..." class="w-full pl-11 pr-4 py-3 text-sm font-medium border border-slate-200 rounded-xl focus:ring-2 focus:ring-purple-500 outline-none transition bg-white shadow-sm">
                    <svg class="w-5 h-5 text-slate-400 absolute left-4 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <button onclick="openMessageModal()" class="w-full sm:w-auto bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-purple-200 flex items-center justify-center gap-2 transition transform hover:-translate-y-0.5 whitespace-nowrap">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 00-2-2H5a2 2 0 00-2-2v10a2 2 0 002 2z"></path></svg>
                    G·ª≠i Th√¥ng B√°o (<span id="countSelected">0</span>)
                </button>
            </div>
        </div>

        <div class="bg-white rounded-[1.5rem] shadow-lg shadow-purple-100/50 border border-purple-100 relative overflow-hidden flex flex-col w-full">
            <div class="absolute top-0 right-0 w-64 h-64 bg-purple-200/40 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none"></div>
            
            <div class="overflow-x-auto w-full relative z-10 table-scroll pb-1">
                <table class="w-full text-sm text-left text-slate-600 min-w-[700px] md:min-w-[900px]">
                    <thead class="text-[11px] text-slate-500 uppercase bg-slate-50/50 border-b border-slate-100">
                        <tr>
                            <th class="px-4 sm:px-5 py-4 text-center w-12"><input type="checkbox" id="checkAll" onchange="toggleAllCheckboxes()" class="w-4 h-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500"></th>
                            <th class="px-4 sm:px-6 py-4 font-black tracking-widest text-purple-900 whitespace-nowrap">Th√†nh Vi√™n Master</th>
                            <th class="px-4 sm:px-6 py-4 font-black tracking-widest whitespace-nowrap">Li√™n h·ªá</th>
                            <th class="px-4 sm:px-6 py-4 font-black tracking-widest whitespace-nowrap">Ch·ª©c V·ª• & Tr·∫°ng Th√°i</th>
                            <th class="px-4 sm:px-6 py-4 font-black text-center tracking-widest w-36 whitespace-nowrap">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyMembers" class="divide-y divide-slate-50">
                        {{ range .DanhSach }}
                        <tr class="bg-white hover:bg-purple-50/30 transition group">
                            <td class="px-4 sm:px-5 py-4 text-center"><input type="checkbox" value="{{ .MaKhachHang }}" class="chk-member w-4 h-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500" onchange="updateCount()"></td>
                            <td class="px-4 sm:px-6 py-4 min-w-[220px]">
                                <div class="flex items-center gap-3">
                                    <div class="w-11 h-11 shrink-0 rounded-full border-2 border-white bg-slate-100 overflow-hidden shadow-sm">
                                        {{ $avatar := .AnhDaiDien }}
                                        {{ if not $avatar }}
                                            {{ $avatar = print "https://ui-avatars.com/api/?name=" .TenKhachHang "&background=f3e8ff&color=7e22ce&bold=true" }}
                                        {{ end }}
                                        <img src="{{ $avatar }}" onerror="this.src='https://ui-avatars.com/api/?name=99K&background=f3e8ff&color=7e22ce'" class="w-full h-full object-cover">
                                    </div>
                                    <div class="min-w-0">
                                        <div class="font-black text-slate-800 text-[15px] group-hover:text-purple-700 transition search-target truncate">{{ .TenKhachHang }}</div>
                                        <div class="text-[11px] text-slate-400 font-mono mt-0.5 truncate">ID: {{ .MaKhachHang }}</div>
                                        <div class="text-[11px] text-purple-500 font-bold search-target truncate">User: {{ .TenDangNhap }}</div>
                                    </div>
                                </div>
                            </td>
                            
                            <td class="px-4 sm:px-6 py-4 text-xs space-y-1.5 whitespace-nowrap">
                                <div class="flex items-center gap-2"><span class="text-slate-400">üìû</span> <span class="font-bold text-slate-700 search-target">{{ if .DienThoai }}{{ .DienThoai }}{{ else }}---{{ end }}</span></div>
                                <div class="flex items-center gap-2"><span class="text-slate-400">üìß</span> <span class="font-bold text-slate-700 search-target">{{ if .Email }}{{ .Email }}{{ else }}---{{ end }}</span></div>
                                {{ if .MangXaHoi.Zalo }}
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-blue-600 font-black bg-blue-50 border border-blue-100 px-1.5 py-0.5 rounded text-[9px] tracking-widest">ZALO</span>
                                    <span class="font-bold text-blue-600 search-target">{{ .MangXaHoi.Zalo }}</span>
                                </div>
                                {{ end }}
                            </td>
                            
                            <td class="px-4 sm:px-6 py-4 whitespace-nowrap">
                                <div class="flex flex-col gap-2 items-start">
                                    <div>
                                        {{ if or (eq .VaiTroQuyenHan "quan_tri_he_thong") (eq .MaKhachHang "0000000000000000000") }}
                                            <span class="bg-slate-900 text-yellow-400 text-[10px] font-black tracking-widest px-3 py-1.5 rounded-lg shadow-sm uppercase whitespace-nowrap">{{ .ChucVu }}</span>
                                        {{ else if eq .VaiTroQuyenHan "quan_tri_vien_he_thong" }}
                                            <span class="bg-red-600 text-white text-[10px] font-black tracking-widest px-3 py-1.5 rounded-lg shadow-sm uppercase whitespace-nowrap">{{ .ChucVu }}</span>
                                        {{ else }}
                                            <span class="bg-purple-100 text-purple-700 text-xs font-bold px-3 py-1.5 rounded-lg uppercase tracking-wide whitespace-nowrap">{{ .ChucVu }}</span>
                                        {{ end }}
                                    </div>
                                    
                                    <div>
                                        {{ if eq .TrangThai 1 }}
                                            <span class="inline-flex items-center gap-1.5 bg-emerald-50 text-emerald-700 px-2.5 py-1 rounded-full text-[10px] font-bold border border-emerald-200"><span class="w-1.5 h-1.5 bg-emerald-500 rounded-full animate-pulse"></span> Ho·∫°t ƒë·ªông</span>
                                        {{ else if eq .TrangThai 0 }}
                                            <span class="inline-flex items-center gap-1.5 bg-amber-50 text-amber-700 px-2.5 py-1 rounded-full text-[10px] font-bold border border-amber-200"><span class="w-1.5 h-1.5 bg-amber-500 rounded-full"></span> T·∫°m kh√≥a</span>
                                        {{ else if eq .TrangThai -1 }}
                                            <span class="inline-flex items-center gap-1.5 bg-red-50 text-red-700 px-2.5 py-1 rounded-full text-[10px] font-bold border border-red-200"><span class="w-1.5 h-1.5 bg-red-500 rounded-full"></span> ƒê·ª£i x√≥a</span>
                                        {{ end }}
                                    </div>
                                </div>
                            </td>
                            
                            <td class="px-4 sm:px-6 py-4 text-center">
                                <button onclick="editMember('{{ .MaKhachHang }}')" class="group inline-flex items-center justify-center gap-2 bg-white text-purple-600 hover:bg-purple-600 hover:text-white px-4 py-2.5 rounded-xl text-[13px] font-bold transition-all shadow-sm border border-purple-200 hover:shadow-purple-200 hover:shadow-md active:scale-95 whitespace-nowrap">
                                    <svg class="w-4 h-4 text-purple-400 group-hover:text-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                                    <span>S·ª≠a H·ªì S∆°</span>
                                </button>
                            </td>
                        </tr>
                        {{ end }}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="data_members" class="hidden">
        {{ range .DanhSach }}
        <div class="m-data" 
            data-id="{{ .MaKhachHang }}" data-name="{{ .TenKhachHang }}" data-user="{{ .TenDangNhap }}" data-email="{{ .Email }}"
            data-role="{{ .VaiTroQuyenHan }}" data-title="{{ .ChucVu }}" 
            data-phone="{{ .DienThoai }}" data-dob="{{ .NgaySinh }}" data-gender="{{ .GioiTinh }}" 
            data-address="{{ .DiaChi }}" data-tax="{{ .MaSoThue }}" data-status="{{ .TrangThai }}"
            data-zalo="{{ .MangXaHoi.Zalo }}" data-fb="{{ .MangXaHoi.Facebook }}" data-tiktok="{{ .MangXaHoi.Tiktok }}"
            data-note="{{ .GhiChu }}" data-avatar="{{ .AnhDaiDien }}" data-source="{{ .NguonKhachHang }}"
            data-created="{{ .NgayTao }}" data-updater="{{ .NguoiCapNhat }}" data-updated="{{ .NgayCapNhat }}">
        </div>
        {{ end }}
    </div>

    <div id="modalEdit" class="hidden fixed inset-0 bg-slate-900/70 flex items-center justify-center z-50 backdrop-blur-md p-4 sm:p-6">
        <div class="bg-slate-50 rounded-[2rem] shadow-2xl w-full max-w-6xl transform transition-all flex flex-col max-h-[95vh] border border-white/20">
            
            <div class="px-6 sm:px-8 py-5 sm:py-6 border-b border-slate-200 flex justify-between items-center bg-white rounded-t-[2rem] shrink-0">
                <div class="flex items-center gap-3">
                    <span class="bg-purple-100 p-2 sm:p-2.5 rounded-2xl text-purple-600 shadow-inner">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                    </span>
                    <h3 class="text-xl sm:text-2xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-purple-700 to-indigo-600" id="modalTitle">H·ªì S∆° & Ph√¢n Quy·ªÅn</h3>
                </div>
                <button onclick="closeModal('modalEdit')" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-500 hover:bg-red-50 hover:text-red-500 transition text-xl font-bold">&times;</button>
            </div>
            
            <div class="p-4 sm:p-8 overflow-y-auto custom-scroll relative">
                <form id="formEdit" class="space-y-6" autocomplete="off" spellcheck="false">
                    <input type="hidden" name="ma_khach_hang" id="f_ma">
                    
                    <div class="bg-indigo-50/80 border border-indigo-100 p-4 sm:p-5 rounded-2xl flex items-start gap-4 mb-6 shadow-sm">
                        <div class="bg-indigo-100 p-2 sm:p-2.5 rounded-full text-indigo-600 shrink-0">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div>
                            <h4 class="text-sm font-black text-indigo-900 mb-1">L∆∞u √Ω qu·∫£n tr·ªã</h4>
                            <p class="text-xs sm:text-[13px] text-indigo-800/80 leading-relaxed font-medium">
                                D·ªØ li·ªáu hi·ªÉn th·ªã b√™n d∆∞·ªõi l√† <b>h·ªì s∆° th·∫≠t</b> c·ªßa th√†nh vi√™n. M·ªçi ch·ªânh s·ª≠a t·∫°i ƒë√¢y s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ª±c ti·∫øp v√†o c∆° s·ªü d·ªØ li·ªáu v√† l√†m thay ƒë·ªïi th√¥ng tin c√° nh√¢n c·ªßa ng∆∞·ªùi d√πng tr√™n to√†n h·ªá th·ªëng.
                            </p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 sm:gap-8">
                        
                        <div class="lg:col-span-7">
                            <div class="bg-white p-6 sm:p-8 rounded-[1.5rem] shadow-lg shadow-purple-100/50 border border-purple-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-48 h-48 bg-purple-100/60 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                                
                                <h4 class="font-black text-purple-700 border-b border-purple-50 pb-3 mb-6 uppercase tracking-widest text-[11px] flex items-center gap-2 relative z-10">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg> 
                                    Th√¥ng tin c∆° b·∫£n & Li√™n h·ªá
                                </h4>
                                
                                <div class="space-y-6 relative z-10">
                                    <div>
                                        <label class="form-lbl">H·ªç v√† t√™n <span class="text-red-500">*</span></label>
                                        <input type="text" name="ten_khach_hang" id="f_ten" class="input-premium font-bold text-slate-900" required>
                                    </div>
                                    
                                    <div>
                                        <label class="form-lbl">Link ·∫¢nh ƒë·∫°i di·ªán</label>
                                        <input type="url" name="anh_dai_dien" id="f_avatar" class="input-premium font-mono text-[13px] text-blue-600" placeholder="https://...">
                                    </div>
                                    
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div><label class="form-lbl">ƒêi·ªán tho·∫°i</label><input type="tel" id="f_sdt_fake" class="input-premium"></div>
                                        <div><label class="form-lbl">Ng√†y sinh</label><input type="date" name="ngay_sinh" id="f_dob" class="input-premium bg-white"></div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div>
                                            <label class="form-lbl">Gi·ªõi t√≠nh</label>
                                            <select name="gioi_tinh" id="f_gender" class="input-premium bg-white cursor-pointer"><option value="-1">Kh√°c</option><option value="1">Nam</option><option value="0">N·ªØ</option></select>
                                        </div>
                                        <div><label class="form-lbl">M√£ s·ªë thu·∫ø</label><input type="text" name="ma_so_thue" id="f_tax" class="input-premium"></div>
                                    </div>
                                    
                                    <div><label class="form-lbl">ƒê·ªãa ch·ªâ</label><input type="text" name="dia_chi" id="f_address" class="input-premium" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, ph∆∞·ªùng x√£..."></div>

                                    <div class="pt-6 border-t border-purple-50">
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                            <div><label class="form-lbl text-blue-600">Zalo (SƒêT)</label><input type="tel" id="f_zalo_fake" class="input-premium"></div>
                                            <div><label class="form-lbl text-emerald-600">Ngu·ªìn kh√°ch h√†ng</label><input type="text" name="nguon_khach_hang" id="f_source" class="input-premium bg-emerald-50/50" placeholder="VD: ƒêƒÉng k√Ω Web..."></div>
                                            
                                            <div class="sm:col-span-2"><label class="form-lbl text-blue-600">Link Facebook</label><input type="text" name="facebook" id="f_fb" class="input-premium font-mono text-[13px] text-blue-600" placeholder="https://facebook.com/..."></div>
                                            <div class="sm:col-span-2"><label class="form-lbl text-slate-800">Link Tiktok</label><input type="text" name="tiktok" id="f_tiktok" class="input-premium font-mono text-[13px] text-blue-600" placeholder="https://tiktok.com/@..."></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-5 space-y-6 sm:space-y-8">
                            
                            <div class="bg-white p-6 sm:p-8 rounded-[1.5rem] shadow-lg shadow-purple-100/50 border border-purple-100 relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-48 h-48 bg-purple-100/60 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                                <h4 class="font-black text-purple-700 border-b border-purple-50 pb-3 uppercase tracking-widest text-[11px] flex items-center gap-2 mb-6 relative z-10">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg> H·ªá th·ªëng & Quy·ªÅn h·∫°n
                                </h4>
                                
                                <div class="space-y-6 relative z-10">
                                    <div>
                                        <label class="form-lbl text-purple-900">Vai tr√≤ / Ph√¢n quy·ªÅn <span class="text-red-500">*</span></label>
                                        <select name="vai_tro" id="f_role" class="input-premium bg-purple-50/50 border-purple-200 text-purple-900 font-bold focus:ring-purple-600 cursor-pointer shadow-sm" required>
                                            {{ range .DanhSachVaiTro }}
                                                <option value="{{ .MaVaiTro }}">{{ .TenVaiTro }}</option>
                                            {{ end }}
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="form-lbl text-purple-900">Ch·ª©c v·ª• hi·ªÉn th·ªã (T√πy ch·ªânh)</label>
                                        <input type="text" name="chuc_vu" id="f_title" class="input-premium bg-white border-purple-100" placeholder="ƒê·ªÉ tr·ªëng s·∫Ω l·∫•y theo Vai tr√≤...">
                                    </div>
                                    
                                    <div>
                                        <label class="form-lbl text-purple-900">Tr·∫°ng th√°i t√†i kho·∫£n</label>
                                        <select name="trang_thai" id="f_status" class="input-premium bg-white font-bold cursor-pointer border-purple-100 shadow-sm">
                                            <option value="1" class="text-emerald-600">üü¢ Ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</option>
                                            <option value="0" class="text-amber-600">üü° T·∫°m kh√≥a</option>
                                            <option value="-1" class="text-red-600">üî¥ ƒê·ª£i x√≥a</option>
                                        </select>
                                    </div>

                                    <div id="box_cap_lai_bao_mat" class="pt-6 border-t border-purple-50">
                                        <h4 class="font-black text-orange-600 uppercase tracking-widest text-[10px] flex items-center gap-2 mb-4">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> C·∫•p l·∫°i B·∫£o m·∫≠t
                                        </h4>
                                        <div class="space-y-4">
                                            <div>
                                                <label class="form-lbl text-orange-800">M·∫≠t kh·∫©u m·ªõi</label>
                                                <div class="relative">
                                                    <input type="password" name="mat_khau_moi" id="f_pass" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');" class="input-premium font-mono pr-10 border-orange-200 bg-orange-50/30" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi...">
                                                    <button type="button" onclick="togglePass('f_pass')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-slate-400 hover:text-orange-600"><svg id="eye_slash_f_pass" class="w-5 h-5 block" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" /></svg><svg id="eye_open_f_pass" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="form-lbl text-orange-800">M√£ PIN m·ªõi (8 s·ªë)</label>
                                                <div class="relative">
                                                    <input type="password" name="pin_moi" id="f_pin" maxlength="8" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');" class="input-premium font-mono tracking-widest pr-10 border-orange-200 bg-orange-50/30 text-center" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi...">
                                                    <button type="button" onclick="togglePass('f_pin')" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-slate-400 hover:text-orange-600"><svg id="eye_slash_f_pin" class="w-5 h-5 block" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" /></svg><svg id="eye_open_f_pin" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-50 p-6 sm:p-8 rounded-[1.5rem] shadow-sm border border-slate-200 relative overflow-hidden">
                                <h4 class="font-black text-purple-600 border-b border-slate-200 pb-3 mb-5 uppercase tracking-widest text-[11px] flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> D·ªØ li·ªáu qu·∫£n tr·ªã
                                </h4>
                                
                                <div class="space-y-4 mb-6 text-[13px] font-medium font-mono text-slate-500">
                                    <div class="flex justify-between items-center"><span class="text-slate-400">Ng√†y gia nh·∫≠p:</span> <span id="f_log_created" class="font-bold text-slate-800">--</span></div>
                                    <div class="flex justify-between items-center"><span class="text-slate-400">C·∫≠p nh·∫≠t l√∫c:</span> <span id="f_log_updated" class="font-bold text-slate-800">--</span></div>
                                    <div class="flex justify-between items-center"><span class="text-slate-400">C·∫≠p nh·∫≠t cu·ªëi:</span> <span id="f_log_updater" class="font-bold text-purple-600">--</span></div>
                                </div>

                                <div class="pt-5 border-t border-slate-200">
                                    <label class="form-lbl text-slate-500">Ghi ch√∫ n·ªôi b·ªô (Ch·ªâ Admin th·∫•y)</label>
                                    <textarea name="ghi_chu" id="f_note" rows="3" class="w-full bg-white border border-slate-300 rounded-xl p-3 text-sm text-slate-700 focus:border-purple-500 outline-none transition shadow-sm leading-relaxed" placeholder="Ghi ch√∫ v·ªÅ t√†i kho·∫£n n√†y..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="px-6 sm:px-8 py-4 sm:py-5 border-t border-slate-200 bg-white rounded-b-[2rem] flex flex-col sm:flex-row justify-end gap-3 shrink-0 z-20 shadow-[0_-10px_20px_-5px_rgba(0,0,0,0.05)]">
                <button onclick="closeModal('modalEdit')" class="w-full sm:w-auto px-8 py-3 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-xl font-bold transition">ƒê√≥ng Modal</button>
                <button onclick="saveMember()" id="btnSaveMem" class="w-full sm:w-auto px-10 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-black rounded-xl hover:from-purple-700 hover:to-indigo-700 shadow-xl shadow-purple-600/30 transition transform hover:-translate-y-1 active:scale-95 flex items-center justify-center gap-2 text-[15px]">
                    L∆∞u Thay ƒê·ªïi
                </button>
            </div>
        </div>
    </div>

    <div id="modalMsg" class="hidden fixed inset-0 bg-slate-900/60 flex items-center justify-center z-50 backdrop-blur-sm p-4">
        </div>

    <script>
        const currentUserID = "{{ .NhanVien.MaKhachHang }}"; 
        const isMeRoot = (currentUserID === "0000000000000000001");
        let itiPhone, itiZalo;

        // ... C√°c logic helper kh√°c gi·ªØ nguy√™n ...

        function editMember(ma) {
            let data = mapData[ma]; if(!data) return;
            document.getElementById('formEdit').reset();
            
            // ... Set value input gi·ªØ nguy√™n ...

            const isSystemBot = (ma === "0000000000000000000");
            const boxBaoMat = document.getElementById('box_cap_lai_bao_mat');
            if (isSystemBot) {
                boxBaoMat.classList.add('hidden');
            } else {
                boxBaoMat.classList.remove('hidden');
            }

            const isTargetRoot = (ma === "0000000000000000001");
            let roleSelect = document.getElementById('f_role');
            let statusSelect = document.getElementById('f_status');

            Array.from(roleSelect.options).forEach(opt => {
                // [M·ªöI] Kh√≥a c·ª©ng Dropdown: Kh√≥a option quan_tri_he_thong ƒë·ªëi v·ªõi ng∆∞·ªùi kh√°c
                if (opt.value === "quan_tri_he_thong") {
                    opt.disabled = (ma !== "0000000000000000001");
                } else if (opt.value === "quan_tri_vien_he_thong") {
                    opt.disabled = !isMeRoot; 
                } else { 
                    opt.disabled = false; 
                }
            });

            roleSelect.value = data.role;
            statusSelect.value = data.status;
            roleSelect.disabled = false;
            statusSelect.disabled = false;

            if (isTargetRoot) { roleSelect.disabled = true; if (!isMeRoot) statusSelect.disabled = true; } 
            else if (data.role === "quan_tri_vien_he_thong" && !isMeRoot) { roleSelect.disabled = true; }
            if (ma === currentUserID) { statusSelect.disabled = true; }

            document.getElementById('modalEdit').classList.remove('hidden');
        }

        // ... C√°c function saveMember v√† sendMessages gi·ªØ nguy√™n ...
    </script>
    {{ template "footer_master" . }}
{{ end }}
